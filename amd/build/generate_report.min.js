define("local_log_sender/generate_report",["jquery","core/ajax","core/notification","core/str","core/url"],(function($,Ajax,Notification,Str,Url){var GenerateReport=function(requestorId,userId,userName,contextId){this.requestorId=parseInt(requestorId),this.userId=parseInt(userId),this.userName=userName,this.start=null,this.end=null,this.contextId=contextId,this.timer=2500,this.file=!1,this.formdata={},this.polling=null,$("#submitdate").click(function(e){e.preventDefault();const startDate=Math.floor(document.querySelector("#start-input").valueAsNumber/1e3),endDate=Math.floor(document.querySelector("#end-input").valueAsNumber/1e3),completion=this.checkCompletion(startDate,endDate),icon=$("<img/>");if(icon.attr("alt","loading"),icon.attr("title","loading"),icon.attr("class","local_log_sender_icon loader"),icon.attr("src",Url.imageUrl("loading","local_log_sender")),!completion)return Notification.alert(Str.get_string("error"),Str.get_string("error:completiondates","local_log_sender"));var formdata={requestorid:this.requestorId,userid:this.userId,username:this.userName,startdate:startDate,enddate:endDate,contextid:this.contextId};this.formdata=formdata,Ajax.call([{methodname:"local_log_sender_generate_time_report",args:{jsonformdata:JSON.stringify(formdata)},done:function(){Str.get_string("client:reportgenerating","local_log_sender").done((function(str){$("#report-area").addClass("alert-warning").html(str).prepend(icon)}));var that=this;that.polling=setInterval(pollFile.bind(that),7500)}.bind(this),fail:Notification.exception}])}.bind(this))};GenerateReport.prototype.checkCompletion=function(startDate,endDate){return 0!=startDate.length&&0!=endDate.length};var pollFile=function(){const dlicon=$("<img/>");dlicon.attr("alt","download"),dlicon.attr("title","download"),dlicon.attr("class","local_log_sender_icon"),dlicon.attr("src",Url.imageUrl("download","local_log_sender")),Ajax.call([{methodname:"local_log_sender_poll_report_file",args:{jsonformdata:JSON.stringify(this.formdata)},done:function(data){if(1==data.status)return Str.get_string("client:reportdownload","local_log_sender").done((function(str){var content=$('<a href="'+data.path+'" target="_blank">'+str+"</a>").prepend(dlicon);$("#report-area").removeClass("alert-warning").addClass("alert-success").html(content)})),void clearInterval(this.polling)}.bind(this),fail:Notification.exception}])};return{generateReport:function(requestorId,userId,userName,contextId){return new GenerateReport(requestorId,userId,userName,contextId)}}}));

//# sourceMappingURL=generate_report.min.js.map