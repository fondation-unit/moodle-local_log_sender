{"version":3,"file":"generate_report.min.js","sources":["../src/generate_report.js"],"sourcesContent":["define(['jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/url'],\n    function ($, Ajax, Notification, Str, Url) {\n        'use strict';\n\n        var GenerateReport = function (requestorId, userId, userName, contextId) {\n            this.requestorId = parseInt(requestorId);\n            this.userId = parseInt(userId);\n            this.userName = userName;\n            this.start = null;\n            this.end = null;\n            this.contextId = contextId;\n            this.timer = 2500;\n            this.file = false;\n            this.formdata = {};\n            this.polling = null;\n\n            $('#submitdate').click(function (e) {\n                e.preventDefault();\n\n                var startDate = document.querySelector('#startInput').valueAsNumber;\n                var endDate = document.querySelector('#endInput').valueAsNumber;\n                var completion = this.checkCompletion(startDate, endDate);\n\n                var icon = $('<img/>');\n                icon.attr('alt', 'loading');\n                icon.attr('title', 'loading');\n                icon.attr('class', 'local_log_sender_icon loader');\n                icon.attr('src', Url.imageUrl('loading', 'local_log_sender'));\n\n                if (!completion) {\n                    return Notification.alert(\n                        Str.get_string('error'),\n                        Str.get_string('error:completiondates', 'local_log_sender')\n                    );\n                }\n\n                var formdata = {\n                    requestorid: this.requestorId,\n                    userid: this.userId,\n                    username: this.userName,\n                    start: startDate,\n                    end: endDate,\n                    contextid: this.contextId\n                };\n                this.formdata = formdata;\n\n                Ajax.call([{\n                    methodname: 'local_log_sender_generate_time_report',\n                    args: { jsonformdata: JSON.stringify(formdata) },\n                    done: function () {\n                        Str.get_string('client:reportgenerating', 'local_log_sender').done(function (str) {\n                            $('#report-area').addClass('alert-warning')\n                                .html(str).prepend(icon);\n                        });\n                        var that = this;\n                        (function foo() {\n                            that.polling = setInterval(pollFile.bind(that), 7500);\n                        })();\n                    }.bind(this),\n                    fail: Notification.exception\n                }]);\n            }.bind(this));\n        };\n\n        GenerateReport.prototype.checkCompletion = function (startDate, endDate) {\n            if (startDate.length == 0 || endDate.length == 0) {\n                return false;\n            }\n            return true;\n        };\n\n        var pollFile = function () {\n            var dlicon = $('<img/>');\n            dlicon.attr('alt', 'download');\n            dlicon.attr('title', 'download');\n            dlicon.attr('class', 'local_log_sender_icon');\n            dlicon.attr('src', Url.imageUrl('download', 'local_log_sender'));\n\n            Ajax.call([{\n                methodname: 'local_log_sender_poll_report_file',\n                args: { jsonformdata: JSON.stringify(this.formdata) },\n                done: function (data) {\n                    if (data.status == true) {\n                        Str.get_string('client:reportdownload', 'local_log_sender').done(function (str) {\n                            var content = $('<a href=\"' + data.path + '\" target=\"_blank\">' + str + '</a>').prepend(dlicon);\n                            $('#report-area').removeClass('alert-warning').addClass('alert-success')\n                                .html(content);\n                        });\n                        clearInterval(this.polling);\n                        return;\n                    }\n                }.bind(this),\n                fail: Notification.exception\n            }]);\n        };\n\n        return {\n            generateReport: function (requestorId, userId, userName, contextId) {\n                return new GenerateReport(requestorId, userId, userName, contextId);\n            }\n        };\n    }\n);\n"],"names":["define","$","Ajax","Notification","Str","Url","GenerateReport","requestorId","userId","userName","contextId","parseInt","start","end","timer","file","formdata","polling","click","e","preventDefault","startDate","document","querySelector","valueAsNumber","endDate","completion","this","checkCompletion","icon","attr","imageUrl","alert","get_string","requestorid","userid","username","contextid","call","methodname","args","jsonformdata","JSON","stringify","done","str","addClass","html","prepend","that","setInterval","pollFile","bind","fail","exception","prototype","length","dlicon","data","status","content","path","removeClass","clearInterval","generateReport"],"mappings":"AAAAA,0CAAO,CAAC,SACJ,YACA,oBACA,WACA,aACA,SAAUC,EAAGC,KAAMC,aAAcC,IAAKC,SAG9BC,eAAiB,SAAUC,YAAaC,OAAQC,SAAUC,gBACrDH,YAAcI,SAASJ,kBACvBC,OAASG,SAASH,aAClBC,SAAWA,cACXG,MAAQ,UACRC,IAAM,UACNH,UAAYA,eACZI,MAAQ,UACRC,MAAO,OACPC,SAAW,QACXC,QAAU,KAEfhB,EAAE,eAAeiB,MAAM,SAAUC,GAC7BA,EAAEC,qBAEEC,UAAYC,SAASC,cAAc,eAAeC,cAClDC,QAAUH,SAASC,cAAc,aAAaC,cAC9CE,WAAaC,KAAKC,gBAAgBP,UAAWI,SAE7CI,KAAO5B,EAAE,aACb4B,KAAKC,KAAK,MAAO,WACjBD,KAAKC,KAAK,QAAS,WACnBD,KAAKC,KAAK,QAAS,gCACnBD,KAAKC,KAAK,MAAOzB,IAAI0B,SAAS,UAAW,sBAEpCL,kBACMvB,aAAa6B,MAChB5B,IAAI6B,WAAW,SACf7B,IAAI6B,WAAW,wBAAyB,yBAI5CjB,SAAW,CACXkB,YAAaP,KAAKpB,YAClB4B,OAAQR,KAAKnB,OACb4B,SAAUT,KAAKlB,SACfG,MAAOS,UACPR,IAAKY,QACLY,UAAWV,KAAKjB,gBAEfM,SAAWA,SAEhBd,KAAKoC,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CAAEC,aAAcC,KAAKC,UAAU3B,WACrC4B,KAAM,WACFxC,IAAI6B,WAAW,0BAA2B,oBAAoBW,MAAK,SAAUC,KACzE5C,EAAE,gBAAgB6C,SAAS,iBACtBC,KAAKF,KAAKG,QAAQnB,aAEvBoB,KAAOtB,KAEPsB,KAAKhC,QAAUiC,YAAYC,SAASC,KAAKH,MAAO,OAEtDG,KAAKzB,MACP0B,KAAMlD,aAAamD,cAEzBF,KAAKzB,QAGXrB,eAAeiD,UAAU3B,gBAAkB,SAAUP,UAAWI,gBACpC,GAApBJ,UAAUmC,QAAiC,GAAlB/B,QAAQ+B,YAMrCL,SAAW,eACPM,OAASxD,EAAE,UACfwD,OAAO3B,KAAK,MAAO,YACnB2B,OAAO3B,KAAK,QAAS,YACrB2B,OAAO3B,KAAK,QAAS,yBACrB2B,OAAO3B,KAAK,MAAOzB,IAAI0B,SAAS,WAAY,qBAE5C7B,KAAKoC,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAAEC,aAAcC,KAAKC,UAAUhB,KAAKX,WAC1C4B,KAAM,SAAUc,SACO,GAAfA,KAAKC,cACLvD,IAAI6B,WAAW,wBAAyB,oBAAoBW,MAAK,SAAUC,SACnEe,QAAU3D,EAAE,YAAcyD,KAAKG,KAAO,qBAAuBhB,IAAM,QAAQG,QAAQS,QACvFxD,EAAE,gBAAgB6D,YAAY,iBAAiBhB,SAAS,iBACnDC,KAAKa,iBAEdG,cAAcpC,KAAKV,UAGzBmC,KAAKzB,MACP0B,KAAMlD,aAAamD,oBAIpB,CACHU,eAAgB,SAAUzD,YAAaC,OAAQC,SAAUC,kBAC9C,IAAIJ,eAAeC,YAAaC,OAAQC,SAAUC"}